{% load static %}
{% load humanize %}
{% include "partials/header.html" %}

<body class="bg-gray-100">
  <div class="container py-4">
    <h4 class="mb-3">ðŸ›’ Sales Module</h4>

    <form method="GET" class="mb-3 d-flex align-items-center gap-2">
      <input type="text" name="search" class="form-control" placeholder="Search products">
      <button class="btn btn-primary">Search</button>
    </form>

    <!-- Product List -->
    <table class="table table-hover align-middle">
      <thead class="bg-light">
        <tr>
          <th>#</th>
          <th>Brand</th>
          <th>Model</th>
          <th>Condition</th>
          <th>Qty</th>
          <th>Price</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        {% for product in products %}
        <tr>
          <td>{{ forloop.counter }}</td>
          <td>{{ product.brand }}</td>
          <td>{{ product.model }}</td>
          <td>{{ product.product_condition }}</td>
          <td>{{ product.quantity }}</td>
          <td>â‚±{{ product.price|floatformat:2|intcomma }}</td>
          <td>
            <a href="{% url 'add_to_cart' product.id %}" class="btn btn-sm btn-primary">Add</a>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    <hr>

    <!-- Cart -->
    <h5>ðŸ§¾ Cart</h5>
    <table class="table">
      <thead class="bg-light">
        <tr>
          <th>Product</th>
          <th>Qty</th>
          <th>Price</th>
          <th>Subtotal</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        {% for item in cart_items %}
        <tr>
          <td>{{ item.name }}</td>
          <td>{{ item.quantity }}</td>
          <td>â‚±{{ item.price|floatformat:2|intcomma }}</td>
          <td>â‚±{{ item.subtotal|floatformat:2|intcomma }}</td>
          <td><a href="{% url 'remove_from_cart' item.id %}" class="btn btn-danger btn-sm">Remove</a></td>
        </tr>
        {% empty %}
        <tr><td colspan="5" class="text-center text-muted">Cart is empty.</td></tr>
        {% endfor %}
      </tbody>
    </table>

    <div class="row mt-4">
      <div class="col-md-4 offset-md-8">
        <div class="card p-3 shadow-sm">
          <p>Total Items: <strong>{{ total_items }}</strong></p>
          <p>Total Price: <strong>â‚±{{ total_price|floatformat:2|intcomma }}</strong></p>

          <form method="POST">
            {% csrf_token %}
            <div class="mb-2">
              <label>Payment Mode</label>
              <select name="payment_mode" class="form-control">
                <option>Cash</option>
                <option>Card</option>
              </select>
            </div>

            <div class="mb-2">
              <label>Amount Received</label>
              <input type="number" step="0.01" name="amount_received" class="form-control" required>
            </div>

            <button type="submit" class="btn btn-success w-100">Pay</button>
            <a href="{% url 'clear_cart' %}" class="btn btn-secondary w-100 mt-2">Cancel</a>
          </form>
        </div>
      </div>
    </div>
  </div>
</body>
</html>
